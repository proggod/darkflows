(()=>{var e={};e.id=326,e.ids=[326],e.modules={10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},79646:e=>{"use strict";e.exports=require("child_process")},28354:e=>{"use strict";e.exports=require("util")},7390:(e,t,r)=>{"use strict";r.r(t),r.d(t,{patchFetch:()=>x,routeModule:()=>m,serverHooks:()=>g,workAsyncStorage:()=>y,workUnitAsyncStorage:()=>f});var s={};r.r(s),r.d(s,{GET:()=>p,dynamic:()=>c,runtime:()=>u});var a=r(42706),n=r(28203),o=r(45994),i=r(79646);let l=(0,r(28354).promisify)(i.exec),c="force-dynamic",u="nodejs";async function d(e){try{let[t,r]=await Promise.all([l(`cat /sys/class/net/${e}/statistics/rx_bytes`),l(`cat /sys/class/net/${e}/statistics/tx_bytes`)]);return{rxBytes:parseInt(t.stdout.trim(),10),txBytes:parseInt(r.stdout.trim(),10)}}catch(t){throw Error(`Failed to read stats for ${e}: ${t}`)}}async function p(e){let t=new TextEncoder,r=null,s=!0,a={},n=[];try{let{stdout:e}=await l("ls /sys/class/net");n.push(...e.trim().split("\n").filter(e=>"lo"!==e))}catch(e){return console.error("Error getting network devices:",e),new Response("Failed to get network devices",{status:500})}return new Response(new ReadableStream({start:async o=>{try{for(let t of(e.signal.addEventListener("abort",()=>{console.log("Client disconnected, cleaning up"),s=!1,r&&(clearInterval(r),r=null),o.close()}),n))try{let e=await d(t);a[t]={...e,timestamp:Date.now()}}catch(e){console.error(`Error initializing stats for ${t}:`,e)}r=setInterval(async()=>{if(!s){r&&(clearInterval(r),r=null);return}for(let e of n)try{let n=Date.now(),i=await d(e),l=a[e];if(l){let a=(n-l.timestamp)/1e3,c=i.rxBytes-l.rxBytes,u=i.txBytes-l.txBytes,d=c/1024/a,p=u/1024/a;if(!isNaN(d)&&!isNaN(p)){let a={timestamp:new Date().toLocaleTimeString(),kbIn:d,kbOut:p,device:e};if(s)try{o.enqueue(t.encode(`data: ${JSON.stringify(a)}

`))}catch(e){console.log("Stream closed, stopping data collection:",e),s=!1,r&&(clearInterval(r),r=null);return}}}a[e]={...i,timestamp:n}}catch(a){if(console.error(`Error collecting data for ${e}:`,a),s)try{o.enqueue(t.encode(`event: error
data: ${JSON.stringify({error:String(a),device:e})}

`))}catch(e){console.log("Stream closed during error handling:",e),s=!1,r&&(clearInterval(r),r=null);return}}if(s&&Date.now()%3e4<1e3)try{o.enqueue(t.encode("event: heartbeat\ndata: {}\n\n"))}catch(e){console.log("Stream closed during heartbeat:",e),s=!1,r&&(clearInterval(r),r=null)}},1e3)}catch(e){console.error("Stream setup error:",e),s=!1,r&&(clearInterval(r),r=null),o.error(e)}},cancel:()=>{console.log("Stream cancelled"),s=!1,r&&(clearInterval(r),r=null)}}),{headers:{"Content-Type":"text/event-stream","Cache-Control":"no-cache",Connection:"keep-alive"}})}let m=new a.AppRouteRouteModule({definition:{kind:n.RouteKind.APP_ROUTE,page:"/api/ifstat-stream/route",pathname:"/api/ifstat-stream",filename:"route",bundlePath:"app/api/ifstat-stream/route"},resolvedPagePath:"/usr/local/darkflows/src/live-ifstat/app/api/ifstat-stream/route.ts",nextConfigOutput:"",userland:s}),{workAsyncStorage:y,workUnitAsyncStorage:f,serverHooks:g}=m;function x(){return(0,o.patchFetch)({workAsyncStorage:y,workUnitAsyncStorage:f})}},96487:()=>{},78335:()=>{},42706:(e,t,r)=>{"use strict";e.exports=r(44870)}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[994],()=>r(7390));module.exports=s})();